apiVersion: batch/v1
kind: Job
metadata:
  name: kafka-topics-init
spec:
  template:
    spec:
      containers:
      - name: kafka-topics-creator
        command:
        - /bin/bash
        - -c
        - |
          echo "Waiting for Kafka to be ready..."
          sleep 30
          
          KAFKA_BROKERS="kafka-0.kafka-headless.amazon-api-prod.svc.cluster.local:9092"
          
          echo "Creating topics..."
          
          # Order topics
          kafka-topics --bootstrap-server $KAFKA_BROKERS --create --if-not-exists \
            --topic order.created --partitions 3 --replication-factor 1 \
            --config retention.ms=604800000 --config min.insync.replicas=1
          
          kafka-topics --bootstrap-server $KAFKA_BROKERS --create --if-not-exists \
            --topic order.updated --partitions 3 --replication-factor 1 \
            --config retention.ms=604800000 --config min.insync.replicas=1
          
          # User topics
          kafka-topics --bootstrap-server $KAFKA_BROKERS --create --if-not-exists \
            --topic user.created --partitions 3 --replication-factor 1 \
            --config retention.ms=604800000 --config min.insync.replicas=1
          
          # Notification topics
          kafka-topics --bootstrap-server $KAFKA_BROKERS --create --if-not-exists \
            --topic notification.email --partitions 3 --replication-factor 1 \
            --config retention.ms=259200000 --config min.insync.replicas=1
          
          echo "Topics created successfully!"
          kafka-topics --bootstrap-server $KAFKA_BROKERS --list
